- memory.devices.nvdimm.access_and_discard:
    type = nvdimm_memory_with_access_and_discard
    no s390-virtio
    start_vm = no
    mem_model = "nvdimm"
    nvdimm_size = 524288
    nvdimm_num = 6
    nvdimm_path_prefix = "/tmp/nvdimm{}"
    nvdimm_dict_template = "{{'mem_model':'${mem_model}',{}'source': {{'path': '{}'}}, 'target': {{'size': ${nvdimm_size}, 'size_unit': 'KiB', 'node':{}}}}}"
    nvdimm_dynamic_access = {1: "'mem_access':'shared',", 3: "'mem_access':'private',", 5: "'mem_access':'shared',"}
    nvdimm_dynamic_node = {0: 0, 1: 0, 2: 1, 3: 1, 4: 2, 5: 2}
    nvdimm0_share = "'false'"
    max_mem = 20971520
    base_attrs = "'vcpu': 6, 'placement': 'static', 'memory_unit':'KiB','memory':3145728,'current_mem':3145728,'current_mem_unit':'KiB'"
    numa_attrs = "'cpu': {'numa_cell': [{'id': '0', 'cpus': '0-1', 'memory': '1048576', 'unit': 'KiB'}, {'id': '1', 'cpus': '2-3', 'memory': '1048576', 'unit': 'KiB', 'memAccess':'shared','discard':'yes'},{'id':'2','cpus': '4-5','memory':'1048576','unit':'KiB', 'memAccess':'private','discard':'no'}]}"
    max_attrs = "'max_mem_rt': ${max_mem}, 'max_mem_rt_slots': 16, 'max_mem_rt_unit': 'KiB'"
    variants memory_backing:
        - file:
            source_type = 'file'
        - anonymous:
            source_type = 'anonymous'
        - memfd:
            source_type = 'memfd'
    variants:
        - undefined:
            discard_attr = ""
            access_attr = ""
        - shared_and_discard:
            discard_attr = "'discard':'yes',"
            access_attr = "'access_mode':'shared',"
            nvdimm0_share = "'true'"
        - private_and_no_discard:
            discard_attr = ""
            access_attr = "'access_mode':'private',"
    variants operations:
        - define_nvdimm:
            init_nvdimms_id_range = 0-5
        - hot_plug_nvdimm:
            init_nvdimms_id_range = 0
            hotplug_nvdimms_id_range = 1-5
    share_cmd = "info memdev"
    share_cmd_protocal = "--hmp"
    share_pattern = "memory backend: (\w*nvdimm\w*).*?share: (true|false)"
    exp_share_list = [${nvdimm0_share}, 'true', 'true', 'false', 'false', 'true']
    discard_qom_cmd = '{{"execute":"qom-get", "arguments":{{"path":"/objects/{0}", "property":"discard-data"}}}}'
    exp_discard_list = [False, False, False, False, False, False]
    source_attr = "'source_type':'${source_type}'"
    memory_backing_attrs = "'mb':{${discard_attr} ${access_attr} ${source_attr}}"
    vm_attrs = {${memory_backing_attrs}, ${base_attrs}, ${numa_attrs}, ${max_attrs}}

