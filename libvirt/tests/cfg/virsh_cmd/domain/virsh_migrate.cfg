- virsh.migrate: install setup image_copy unattended_install.cdrom
    type = virsh_migrate
    # Migrating non-started VM causes undefined behavior
    start_vm = yes
    # Console output can only be monitored via virsh console output
    only_pty = True
    take_regular_screendumps = no
    # Options to pass to virsh migrate command before <domain> <desturi>
    virsh_migrate_options = "--live --undefinesource --persistent"
    # Extra options to pass after <domain> <desturi>
    virsh_migrate_extra = "--timeout 60"
    # Fully qualified desturi (qemu+ssh://other.hostname.example.com/system)
    # Remember to open ports 49152-49216 on destination and
    # NAT-based host networking will cause external connectivity-loss
    # to guest, consider a shared-bridge setup instead.
    virsh_migrate_desturi = "qemu+ssh://${migrate_dest_host}/system"
    # FIXME: Implement libvirt URI connect user/password
    # virsh_migrate_destuser = root
    # virsh_migrate_destpwd = ""
    virsh_migrate_dest_state = running
    virsh_migrate_src_state = running
    virsh_migrate_libvirtd_state = 'on'
    # Local URI
    virsh_migrate_connect_uri = "qemu:///system"
    status_error = 'no'
    virsh_migrate_delay = 10
    virsh_migrate_back = 'no'
    # ping args
    ping_count = 10
    ping_timeout = 20
    # setup SSH
    server_ip = "${migrate_dest_host}"
    server_user = "root"
    server_pwd = "migrate_dest_pwd"
    client_ip = "${migrate_source_host}"
    client_user = "root"
    client_pwd = "${migrate_source_pwd}"
    transport = "ssh"
    port = "22"
    client = "ssh"
    # setup NFS test environment
    nfs_client_ip = "${migrate_dest_host}"
    nfs_server_ip = "${migrate_source_host}"
    # in order to avoid selinux issue, it had better to mount
    # source directory to /tmp or /var/lib/libvirt/images
    nfs_mount_dir = "/var/lib/libvirt/images"
    nfs_mount_options = "rw"
    # default to /var/lib/virt_test/images
    nfs_mount_src = "${nfs_mount_dir}"
    export_ip = "*"
    export_options = "rw,no_root_squash"
    setup_local_nfs = "yes"
    # enable virt_use_nfs SELinux boolean
    local_boolean_varible = "virt_use_nfs"
    local_boolean_value = "on"
    remote_boolean_varible = "virt_use_nfs"
    remote_boolean_value = "on"
    set_sebool_local = "yes"
    set_sebool_remote = "yes"
    # A VM image used for migration, it looks like
    # "${nfs_mount_dir}/${vm_image_name}", e.g.
    # "/var/lib/virt_test/images/jeos-19-64.qcow2"
    virsh_migrate_shared_storage = "${migrate_shared_storage}"
    variants:
        - there_live:
            # Uni-direction migration with option --live.
            virsh_migrate_options = "--live"
        - there_p2p:
            # Uni-direction migration with option --p2p.
            virsh_migrate_options = "--live --p2p"
        - there_p2p_tunnelled:
            # Uni-direction migration with option --tunnelled.
            # --tunnelled should be used with --p2p.
            virsh_migrate_options = "--live --p2p --tunnelled"
        - there_direct:
            # Uni-direction migration with option --direct.
            virsh_migrate_options = "--live --direct"
        - there_suspend:
            # Uni-direction migration with option --suspend.
            virsh_migrate_options = "--live --suspend"
            virsh_migrate_dest_state = paused
        - there_persistent:
            # Uni-direction migration with option --persistent.
            virsh_migrate_options = "--live --persistent"
        - there_undefinesource:
            # Uni-direction migration with option --undefinesource.
            virsh_migrate_options = "--live --undefinesource"
        - there_suspend_undefinesource:
            # Uni-direction migration with option --undefinesource.
            virsh_migrate_options = "--live --suspend --undefinesource"
            virsh_migrate_dest_state = paused
        - there_change-protection:
            # Uni-direction migration with option --change-protection.
            virsh_migrate_options = "--live --change-protection"
        - there_with_scsi_disk:
            # Uni-direction migration with another scsi disk
            virsh_migrate_options = "--live"
            attach_scsi_disk = "yes"
        - there_verbose:
            # Uni-direction migration with option --verbose.
            virsh_migrate_options = "--live --verbose"
        - there_unsafe:
            # Uni-direction migration with option --unsafe.
            # Set disk cache to default then migrate without unsafe
            # the first time, confirming its fail then migrate with it.
            virsh_migrate_options = "--live --unsafe"
            virsh_migrate_disk_cache = "default"
        - there_unsafe_cache_writeback:
            # Uni-direction migration with option --unsafe.
            # Set disk cache to writeback then migrate with unsafe
            virsh_migrate_options = "--live --unsafe"
            virsh_migrate_disk_cache = "writeback"
        - there_timeout:
            # Uni-direction migration with option --timeout.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--timeout 30"
        - there_timeout_short:
            # Uni-direction migration with a very short timeout.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--timeout 1"
            virsh_migrate_dest_state = "running"
        - there_migrateuri:
            # Uni-direction migration with option --migrateuri.
            virsh_migrate_options = "--live"
            virsh_migrate_migrateuri = "${migrate_proto}://${migrate_dest_host}:${migrate_port}"
        - there_dname:
            # Uni-direction migration with option --dname.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--dname not_exist_domain"
        - there_xml:
            # Uni-direction migration with option --xml.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--xml /tmp/virsh_migrate.xml"
            virsh_migrate_xml = /tmp/virsh_migrate.xml
        - there_xml_with_dname:
            # Do migration with --dname and --xml with same changed
            # name from guest XML
            virsh_migrate_options = "--live"
            virsh_migrate_src_xml = /tmp/virsh_migrate_src.xml
            virsh_migrate_extra = "--dname guest-new-name --xml ${virsh_migrate_src_xml}"
        - there_offline:
            # Uni-direction offline migration.
            virsh_migrate_options = ""
            virsh_migrate_extra = ""
        - there_vm_suspend_live:
            # Uni-direction live migration with VM suspend.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = ""
            virsh_migrate_src_state = paused
            virsh_migrate_dest_state = paused
        - there_vm_suspend_offline:
            # Uni-direction offline migration with VM suspend.
            virsh_migrate_options = ""
            virsh_migrate_extra = ""
            virsh_migrate_src_state = paused
            virsh_migrate_dest_state = paused
        - there_vm_shutdown_live:
            # Uni-direction live migration with VM shutdown.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = ""
            virsh_migrate_src_state = "shut off"
            status_error = 'yes'
        - there_vm_shutdown_offline:
            # Uni-direction offline migration with VM shutdown.
            virsh_migrate_options = ""
            virsh_migrate_extra = ""
            virsh_migrate_src_state = "shut off"
            status_error = 'yes'
        - there_libvirtd_stop:
            # Uni-direction live migration with libvirtd stop.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = ""
            virsh_migrate_libvirtd_state = 'off'
            status_error = 'yes'
        - there_libvirtd_stop_offline:
            # Uni-direction offline migration with libvirtd stop.
            virsh_migrate_options = ""
            virsh_migrate_extra = ""
            virsh_migrate_libvirtd_state = 'off'
            status_error = 'yes'
        - there_compressed:
            # Uni-direction migration with option --compressed.
            virsh_migrate_options = "--live --compressed"
        - there_seamless_migration_with_graphicsuri:
            virsh_migrate_options = "--live --verbose --unsafe"
            # The default spice port is 5900 for graphic configuration
            # <graphics type='spice' autoport='yes'/> in the guest XML.
            virsh_migrate_graphics_uri = "spice://${migrate_dest_host}:5900"
            graphics_type = "spice"
            graphics_port = 5900
            graphics_listen = 0.0.0.0
            graphics_listen_type = "address"
            graphics_listen_addr = ${graphics_listen}
            graphics_server = "${graphics_type}://${graphics_listen}:${graphics_port}"
        # ERROR
        - there_domain_nonexist:
            # Uni-direction migration with non-exist domain.
            virsh_migrate_options = "--live"
            vm_ref = xyz
            status_error = 'yes'
        - there_domain_missing:
            # Uni-direction migration without option --domain.
            virsh_migrate_options = "--live"
            vm_ref = ""
            status_error = 'yes'
        - there_desturi_nonexist:
            # Uni-direction migration with non-exist desturi.
            virsh_migrate_options = "--live"
            virsh_migrate_desturi = xyz
            status_error = 'yes'
        - there_desturi_missing:
            # Uni-direction migration without option --desturi.
            virsh_migrate_options = "--live"
            virsh_migrate_desturi = ""
            status_error = 'yes'
        - there_migrateuri_nonexist:
            # Uni-direction migration with non-exist migrateuri.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--migrateuri xyz"
            status_error = 'yes'
        - there_timeout_invalid:
            # Uni-direction migration with an invalid timeout.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--timeout -1"
            status_error = 'yes'
        - there_timeout_offline:
            # Uni-direction offline migration with option --timeout.
            virsh_migrate_options = ""
            virsh_migrate_extra = "--timeout 60"
            status_error = 'yes'
        - there_dname_exist:
            # Uni-direction migration with an existing dname.
            virsh_migrate_options = "--live"
            # Here, dest_exist_vm is an existing VM name on destination.
            virsh_migrate_extra = "--dname dest_exist_vm"
            status_error = 'yes'
        - there_xml_nonexist:
            # Uni-direction migration with a non-existing xmlfile.
            virsh_migrate_options = "--live"
            virsh_migrate_extra = "--xml xyz"
            status_error = 'yes'
        - there_cache_writeback_without_unsafe:
            # Uni-direction migration with option --unsafe.
            # Set disk cache to writeback then migrate without unsafe
            virsh_migrate_options = "--live"
            virsh_migrate_disk_cache = "writeback"
            status_error = 'yes'
        - there_xml_with_same_dname:
            # Do migration with --dname and --xml with same changed
            # name from guest XML
            vm_new_name = "guest-new-name"
            virsh_migrate_options = "--live"
            virsh_migrate_src_xml = /tmp/virsh_migrate_src.xml
            virsh_migrate_extra = "--xml ${virsh_migrate_src_xml} --dname ${vm_new_name}"
            status_error = 'yes'
        - there_xml_with_diff_dname:
            # Do migration with --dname and --xml with different changed
            # name from guest XML
            vm_new_name = "guest-new-name"
            virsh_migrate_options = "--live"
            virsh_migrate_src_xml = /tmp/virsh_migrate_src.xml
            virsh_migrate_extra = "--xml ${virsh_migrate_src_xml} --dname ${vm_new_name}-diff"
            status_error = 'yes'
