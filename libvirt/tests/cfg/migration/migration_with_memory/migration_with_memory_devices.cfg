- migration.migration_with_memory.memory_devices:
    type = migration_with_memory_devices
    no s390-virtio
    take_regular_screendumps = no
    migration_setup = "yes"
    storage_type = 'nfs'
    setup_local_nfs = 'yes'
    disk_type = "file"
    disk_source_protocol = "netfs"
    mnt_path_name = ${nfs_mount_dir}
    # Console output can only be monitored via virsh console output
    only_pty = True
    # Extra options to pass after <domain> <desturi>
    virsh_migrate_extra = ""
    # SSH connection time out
    ssh_timeout = 60
    # Local URI
    virsh_migrate_connect_uri = 'qemu:///system'
    virsh_migrate_dest_state = "running"
    virsh_migrate_src_state = "shut off"
    image_convert = "no"
    server_ip = "${migrate_dest_host}"
    server_user = "root"
    server_pwd = "${migrate_dest_pwd}"
    client_ip = "${migrate_source_host}"
    migrate_desturi_port = "22"
    migrate_desturi_type = "ssh"
    virsh_migrate_desturi = "qemu+ssh://${migrate_dest_host}/system"
    bandwidth = 100
    virsh_migrate_options = "--p2p --live --persistent --bandwidth ${bandwidth} --migrateuri tcp://${migrate_dest_host}"
    mem_val = 2097152
    curr_mem_val = 2097152
    start_mem_val = 3145728
    mem_attrs = "'memory_unit':'KiB','memory':${mem_val},'current_mem':${curr_mem_val},'current_mem_unit':'KiB', 'max_mem_rt': 10485760, 'max_mem_rt_slots': 16, 'max_mem_rt_unit': 'KiB'"
    numa_attrs = ", 'vcpu': 4, 'cpu': {'numa_cell': [{'id': '0', 'cpus': '0-1', 'memory': '1048576', 'unit': 'KiB'}, {'id': '1', 'cpus': '2-3', 'memory': '1048576', 'unit': 'KiB'}]}"
    variants hugepage_size:
        - 2m:
            only aarch64, x86_64
            hp_size = 2048
            hp_num = 2048
        - 512m:
            only aarch64
            hp_size = 524288
            hp_num = 8
    variants mem_device_model:
        - dimm:
            mem_model = "dimm"
            mem_define = {'mem_model': '${mem_model}', 'mem_access':'private', 'mem_discard':'no', 'source':{'nodemask':'0'}, 'target': {'size': 512, 'node': 1, 'size_unit': 'MiB'}}
            mem_hotplug = {'mem_model': '${mem_model}', 'mem_access':'shared', 'mem_discard':'yes', 'source':{'pagesize':${hp_size}, 'pagesize_unit':'KiB'}, 'target': {'size': 512, 'node': 0, 'size_unit': 'MiB'}}
            start_curr_mem_val = 2621440
            mem_define_alias = dimm0
            mem_hotplug_alias = dimm1
            mem_define_xpath = [{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='private']", "./memory[@discard='no']"]},{'element_attrs':["./memory/source/nodemask"],'text':'0'}, {'element_attrs':["./memory/target/node"], 'text':'1'}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}]
            mem_hotplug_xpath = [{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='shared']", "./memory[@discard='yes']"]},{'element_attrs':["./memory/source/pagesize[@unit='KiB']"],'text':'${hp_size}'}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/node"],'text':'0'}]
        - virtio-mem:
            func_supported_since_libvirt_ver = (8, 0, 0)
            mem_model = "virtio-mem"
            mem_define = {'mem_model': '${mem_model}', 'mem_access':'shared', 'mem_discard':'yes', 'source':{'pagesize':${hp_size}}, 'target': {'requested_size': 524288,'requested_unit':'KiB', 'block_size': ${hp_size}, 'block_unit':'KiB', 'size': 524288, 'node': 1, 'size_unit': 'KiB'}}
            mem_hotplug = {'mem_model': '${mem_model}', 'mem_access':'private', 'mem_discard':'no', 'target': {'requested_size': 524288,'requested_unit':'KiB', 'block_size': ${hp_size}, 'block_unit':'KiB', 'size': 524288, 'node': 0, 'size_unit': 'KiB'}}
            start_curr_mem_val = 3145728
            mem_define_alias = virtiomem0
            mem_hotplug_alias = virtiomem1
            mem_define_xpath = [{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='shared']", "./memory[@discard='yes']"]}, {'element_attrs':["./memory/source/pagesize[@unit='KiB']"],'text':'${hp_size}'}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/node"],'text':'1'}, {'element_attrs':["./memory/target/block[@unit='KiB']"],'text':'${hp_size}'}, {'element_attrs':["./memory/target/requested[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/current[@unit='KiB']"],'text':'524288'}]
            mem_hotplug_xpath = [{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='private']", "./memory[@discard='no']"]}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/node"],'text':'0'}, {'element_attrs':["./memory/target/block[@unit='KiB']"],'text':'${hp_size}'}, {'element_attrs':["./memory/target/requested[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/current[@unit='KiB']"],'text':'524288'}]
        - nvdimm:
            mem_model = "nvdimm"
            nvdimm_define_path = "${nfs_mount_dir}/nvdimm1"
            nvdimm_hotplug_path = "${nfs_mount_dir}/nvdimm2"
            nvdimm_paths = ["${nvdimm_define_path}", "${nvdimm_hotplug_path}"]
            nvdimm_paths_cmds = ["truncate -s 512M ${nvdimm_define_path}", "truncate -s 512M ${nvdimm_hotplug_path}"]
            mem_define = {'mem_model': '${mem_model}', 'mem_access':'shared', 'source': {'path': '${nvdimm_define_path}'}, 'target': {'size': 524288, 'node': 0, 'size_unit': 'KiB'}}
            mem_hotplug = {'mem_model': '${mem_model}', 'mem_access':'private', 'source': {'path': '${nvdimm_hotplug_path}'}, 'target': {'size': 524288, 'node': 1, 'size_unit': 'KiB'}}
            start_curr_mem_val = 2097152
            nvdimm_define_device = /dev/pmem0
            nvdimm_hotplug_device = /dev/pmem1
            nvdimm_define_mount_path = /mnt/define
            nvdimm_hotplug_mount_path = /mnt/hotplug
            nvdimm_define_file = ${nvdimm_define_mount_path}/define_file.txt
            nvdimm_hotplug_file = ${nvdimm_hotplug_mount_path}/hotplug_file.txt
            nvdimm_define_content = "nvdimm_define_content"
            nvdimm_hotplug_content = "nvdimm_hotplug_content"
            mem_define_alias = nvdimm0
            mem_hotplug_alias = nvdimm1
            mem_define_xpath = [{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='shared']"]},{'element_attrs':["./memory/source/path"],'text':'${nvdimm_define_path}'}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/node"],'text':'0'}]
            mem_hotplug_xpath =[{'element_attrs':["./memory[@model='${mem_model}']", "./memory[@access='private']"]},{'element_attrs':["./memory/source/path"],'text':'${nvdimm_hotplug_path}'}, {'element_attrs':["./memory/target/size[@unit='KiB']"],'text':'524288'}, {'element_attrs':["./memory/target/node"],'text':'1'}]
    variants mem_backing:
        - hugepage:
            mb_attrs = ", 'mb': {'hugepages': {'pages': [{'size': '${hp_size}', 'unit': 'KiB'}]}}"
        - file_backed:
            mb_attrs = ", 'mb': {'source_type':'file'}"
        - anonymous_backed:
            mb_attrs = ", 'mb': {'source_type':'anonymous'}"
        - memfd_backed:
            mb_attrs = ", 'mb': {'source_type':'memfd'}"
    kernel_hp_file = "/sys/kernel/mm/hugepages/hugepages-${hp_size}kB/nr_hugepages"
    mem_xpath = [{'element_attrs':["./memory[@unit='KiB']"],'text':'${start_mem_val}'},{'element_attrs':["./currentMemory[@unit='KiB']"],'text':'${start_curr_mem_val}'}]
    vm_attrs = {${mem_attrs}${numa_attrs}${mb_attrs}}

