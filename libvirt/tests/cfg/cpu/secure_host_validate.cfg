- cpu.secure_launch.secure_host_validate:
    type = secure_host_validate
    start_vm = "no"
    only x86_64
    kernel_msg_cmd = "journalctl -b 0 -k"
    variants:
        - amd_sev:
            cpu_vendor = "amd"
            secure_feature = "sev"
            cpu_flags = ["sev"]
            req_kernel_opts = ["mem_encrypt=on", "amd_iommu=on"]
            kvm_probe_module_force_load = yes
            kvm_probe_module_parameters = "sev=1"
            req_cmds = {"sevctl": {"package": "sevctl", "cmd_params": "ok"}, "virt-host-validate": {"package": "libvirt", "cmd_params": ""}}
            sevctl_patterns = ['\[.*PASS.*\]\s+-\s+Secure\sEncrypted\sVirtualization\s+\(SEV\)']
            virt-host-validate_patterns = ['QEMU: Checking for secure guest support\s+:\s+PASS\n\s*\(SEV']
        - amd_sev_es:
            cpu_vendor = "amd"
            secure_feature = "sev-es"
            cpu_flags = ["sev", "sev_es"]
            req_kernel_opts = ["mem_encrypt=on", "amd_iommu=on"]
            kvm_probe_module_force_load = yes
            kvm_probe_module_parameters = "sev=1 sev-es=1"
            req_cmds = {"sevctl": {"package": "sevctl", "cmd_params": "ok"}, "virt-host-validate": {"package": "libvirt", "cmd_params": ""}}
            sevctl_patterns = ['\[.*PASS.*\]\s+-\s+Secure\sEncrypted\sVirtualization\s+\(SEV\)', '\[.*PASS.*\]\s+-\s+Encrypted\sState\s+\(SEV-ES\)']
            virt-host-validate_patterns = ['QEMU: Checking for secure guest support\s+:\s+PASS\n\s*\(SEV']
        - amd_sev_snp:
            cpu_vendor = "amd"
            secure_feature = "sev-snp"
            cpu_flags = ["sev", "sev_es", "sev_snp"]
            req_kernel_opts = ["mem_encrypt=on", "amd_iommu=on"]
            kvm_probe_module_force_load = yes
            kvm_probe_module_parameters = "sev=1 sev-es=1 sev-snp=1"
            req_cmds = {"sevctl": {"package": "sevctl", "cmd_params": "ok"}, "virt-host-validate": {"package": "libvirt", "cmd_params": ""}}
            sevctl_patterns = ['\[.*PASS.*\]\s+-\s+Secure\sEncrypted\sVirtualization\s+\(SEV\)', '\[.*PASS.*\]\s+-\s+Encrypted\sState\s+\(SEV-ES\)', '\[.*PASS.*\]\s+-\s+Secure Nested Paging\s+\(SEV-SNP\)']
            virt-host-validate_patterns = ['QEMU: Checking for secure guest support\s+:\s+PASS\n\s*\(SEV-SNP\)']
        - intel_sgx:
            func_supported_since_libvirt_ver = (9, 0, 0)
            cpu_vendor = "intel"
            secure_feature = "sgx"
            cpu_flags = ["sgx", "sgx_lc"]
            kernel_msg_patterns = ["EPC section"]
            domcap_xpath = [{'element_attrs':[".//features/sgx[@supported='yes']"]}, {'element_attrs':[".//features/sgx/flc"],'text':'yes'}, {'element_attrs':[".//features/sgx/sgx1"],'text':'yes'}, {'element_attrs':[".//features/sgx/sgx2"],'text':'yes'}, {'element_attrs':[".//features/sgx/section_size[@unit='KiB']"]}, {'element_attrs':[".//features/sgx/sections"]}]
        - intel_tdx:
            func_supported_since_libvirt_ver = (11, 10, 0)
            cpu_vendor = "intel"
            secure_feature = "tdx"
            cpu_flags = ["tdx_host_platform"]
            req_kernel_opts = ["nohibernate", "intel_iommu=on"]
            kvm_probe_module_force_load = yes
            kvm_probe_module_parameters = "tdx=1"
            domcap_xpath = [{'element_attrs':[".//features/launchSecurity[@supported='yes']"]}, {'element_attrs':[".//features/launchSecurity/enum[@name='sectype']"]},  {'element_attrs':[".//features/launchSecurity/enum/value"],'text':'tdx'}]
            req_cmds = {"virt-host-validate": {"package": "libvirt", "cmd_params": ""}}
            virt-host-validate_patterns = ['QEMU: Checking for secure guest support\s+:\s+PASS\n\s*\(TDX\)']

