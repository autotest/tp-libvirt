- virtual_network.qemu_test.change_queues_during_migration:
    type = change_queues_during_migration
    only Linux
    only virtio_net
    create_vm_libvirt = "yes"
    kill_vm_libvirt = "yes"
    ovmf:
        kill_vm_libvirt_options = " --nvram"
    vm_ping_outside = pass
    queues_nic1 = "4"
    start_vm = "no"
    take_regular_screendumps = no
    storage_type = 'nfs'
    setup_local_nfs = 'yes'
    disk_type = "file"
    disk_source_protocol = "netfs"
    nfs_mount_dir = "/var/lib/libvirt/migrate"
    nfs_mount_options = "soft,timeo=50,retrans=3"
    virsh_migrate_dest_state = running
    virsh_migrate_options = "--live --p2p --verbose"
    virsh_migrate_connect_uri = "qemu:///system"
    outside_ip = "8.8.8.8"
    migration_setup = "yes"
    ssh_remote_auth = True
    mnt_path_name = ${nfs_mount_dir}
    nfs_server_ip = "${migrate_source_host}"
    migrate_desturi_port = "22"
    migrate_desturi_type = "ssh"
    virsh_migrate_desturi = "qemu+ssh://${migrate_dest_host}/system"
    vm_ping_outside = "pass"
    migrate_main_vm = "${main_vm}"
    # Multiqueue specific parameters
    initial_queues = "4"
    queue_change_interval = "1"
    wait_bg_time = "10"
    login_timeout = "360"
    migrate_speed = 15
    variants:
        - disable_enable_queues:
            change_list = 1 2 1 3 1 4 1
            max_iterations = "3"
            variants:
                - under_migrate:
                    wait_bg_time = "10"
                    migrate_vm_back = "yes"
                    # Migration during queue changes
                    migration_type = "precopy"
                    virsh_migrate_extra = ""
                    # Use action_during_mig to trigger queue changes during migration
                    action_during_mig = '[{"func": "change_queues_continuously_during_mig", "func_param": "params", "after_event": "iteration: '1'"}]'
