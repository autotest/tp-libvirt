- save_and_restore.managedsave_opt:
    type = managedsave_opt
    start_vm = yes
    status_error = no
    expected_match = ''
    check_cmd_jobinfo = 'while true; do virsh domjobinfo {}; done'
    save_path = "/var/lib/libvirt/qemu/save/"
    variants:
        - opt_none:
            virsh_opt = ''
        - opt_verbose:
            only running
            virsh_opt = '--verbose'
            expected_match = '[100.00 %]'
        - opt_running:
            virsh_opt = '--running'
        - opt_paused:
            only persistent
            virsh_opt = '--paused'
        - opt_bypass_cache:
            only running
            virsh_opt = '--bypass-cache'
            check_cmd = "while(true); do [ -e {} ] && cat /proc/$(lsof -w {}|awk '/libvirt_i/{{print $2}}')/fdinfo/1 ;done"
    variants:
        - running:
            pre_vm_state = 'running'
        - paused:
            pre_vm_state = 'paused'
        - shutoff:
            only persistent
            only opt_none
            only normal
            pre_vm_state = 'shut off'
            status_error = 'yes'
            error_msg = 'domain is not running'
    variants:
        - transient:
            only running
            only opt_none
            only normal
            persistent = 'no'
            status_error = 'yes'
            error_msg = 'cannot do managed save for transient domain'
        - persistent:
            persistent = 'yes'
    variants:
        - normal:
            readonly = 'no'
        - readonly:
            only running
            only opt_none
            readonly = 'yes'
            status_error = 'yes'
            error_msg = 'read only access prevents virDomainManagedSave'
